<!DOCTYPE html>
<html>
  <head>
    <script>
        // TODO: move this to an script.js" file 
        const websocketURL = "ws://localhost:8080/chat"

        function connectWebsocket() {
            return new WebSocket(websocketURL);
        }

        function setWebsocketListeners(socket) {
            socket.addEventListener("open", (event) => {
                console.log("Websocket connection established")
            }) 

            socket.addEventListener("message", (event) => {
                console.log("recv: ", event.data)
            })
        }

        async function renderMessages() {
            const list = document.getElementById("messages");
            
            const response = await fetch("http://localhost:8080/list-message")

            const messagesData = await response.json()

            for (const message of messagesData.messages) {
                const item = document.createElement("li");
                item.textContent = message.content 
                list.appendChild(item)
            }
        }

        async function sendMessage() {
            const input = document.getElementById("user-input")
            await fetch("http://localhost:8080/new-message")
        }

        document.addEventListener("DOMContentLoaded", async function(){
            // Render stuff
            await renderMessages();

            // Websocket
            const websocket = connectWebsocket();
            setWebsocketListeners(websocket);
        });
    </script>
    <title>Cool Chat</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <style>
      html,
      body {
        height: 100vh;
      }

      main {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        width: 100%;
      }

      .chat {
        display: flex;
        flex-direction: column;
        height: 80%;
        width: 50%;
        background-color: #C8C8C8;
        box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
      }

      .messages-wrapper {
          height: 90%;
          width: 100%;
      }

      .messages-list {
          flex-grow: 1;
          list-style-type: none;
      }

      .message {
          width: 20%;
          background-color: orange;
          border: 0px;
      }

      .user-input-wrapper {
        display: flex;
        align-items: cente;
        flex-direction: row;
        height: 10%;
      }

      .user-input {
          width: 80%;
          padding: 0px;
          border: 0;
      }
        
      .user-send-button {
          flex-grow: 1;
          border: 0;
      }

    </style>
  </head>
  <body>
    <main>
        <div class="chat">
            <div class="messages-wrapper">
                <li id="messages" class="messages-list">
                </li>
            </div>
            <section class="user-input-wrapper">
                <input
                    id="user-input"
                    class="user-input"
                    placeholder="Write your message here..."
                />
                <button class="user-send-button">
                    Send
                </button>
            </section>
        </div>
    </main>
  </body>
</html>
